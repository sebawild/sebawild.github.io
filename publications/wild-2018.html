<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Quicksort Is Optimal for Many Equal Keys</title>
  <meta name="description" content="">

  <link rel="stylesheet" href="/fonts/pagella/stylesheet.css" type="text/css" charset="utf-8" />
  <link rel="stylesheet" href="/fonts/epigrafica/stylesheet.css" type="text/css" charset="utf-8" />
  <link rel="stylesheet" href="/fonts/fontawesome/fontawesome-all.min.css" type="text/css" charset="utf-8" />
  <link rel="stylesheet" href="/fonts/academicons/academicons.min.css" type="text/css" charset="utf-8" />
  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://www.wild-inter.net/publications/wild-2018">
  <link rel="alternate" type="application/rss+xml" title="Sebastian Wild's Site" href="https://www.wild-inter.net/feed.xml">
</head>


  <body>

    <header class="site-header">

  <div class="wrapper">

    <a class="site-title" href="/">Sebastian</a>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#46433A" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#46433A" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#46433A" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>
      <div class="trigger">
        
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
          <a class="page-link" href="/research/">Research</a>
          
        
          
          <a class="page-link" href="/teaching/">Teaching</a>
          
        
          
          <a class="page-link" href="/posts/">Blog</a>
          
        
          
          <a class="page-link" href="/about/">About</a>
          
        
      </div>
    </nav>

  </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <article class="post">
	<div class="post-back">
		<small>
			<a href="/publications/"><i class="fas fa-arrow-left"></i> All Publications</a>
		</small>
	</div>

	<header class="publication-header">
		<h1 class="publication-title"><p>Quicksort Is Optimal for Many Equal Keys</p>
</h1>

		<div class="publication-meta">
			<p style="text-align:left">
				<small>
				Jan 2018
				<span style="padding-left:1em;">
					<small>(Written: Apr 2017)</small>
				</span>
				</small>
			</p>
			<p>
				
				
<p>Sebastian Wild:</p>

			</p>
			<p>
				<p><a href="http://www.siam.org/meetings/analco18/">Meeting on Analytic Algorithmics and Combinatorics 2018</a><br /> <small>in Nebel M., Wagner S. (eds.): ANALCO 2018, SIAM, pp 8‚Äì22</small></p>

			</p>
			<p>
				
				| <a href="/publications/html/wild-2018.pdf.html"><em>read here</em></a>
				
				
				
				
					|&nbsp;<a href="wild-2018.pdf" title="wild-2018.pdf (preprint)">PDF</a>
				
				
					|&nbsp;<a href="https://dx.doi.org/10.1137/1.9781611975062.2" title="10.1137/1.9781611975062.2">DOI</a>
<!--			|&nbsp;<a href="https://doi2bib.org/bib/10.1137/1.9781611975062.2" title="BibTeX">bib</a> -->
				
				
				
				
				
					|&nbsp;<a href="https://arxiv.org/abs/1608.04906" title="1608.04906">arXiv</a>
				
				
					|&nbsp;<a href="https://speakerdeck.com/sebawild/median-of-k-quicksort-is-optimal-for-many-equal-keys
">slides</a>
				
				
				
				
				
				|
			</p>

		</div>

	</header>

	<div class="publication-content">
		
<script type="text/x-mathjax-config">
	var font = "Neo-Euler";
	MathJax.Hub.Config({
		tex2jax: {
			inlineMath: [['$','$']],
			displayMath: [['\\[','\\]']],
			processEscapes: true,
		},
		"SVG":{ 
			font:font
		},
		"HTML-CSS": {
			webFont: font,
			imageFont: font,
			preferredFont: font,
			availableFonts: [],
			scale: 85,
			mtextFontInherit: true
		}
	});
</script>

<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

<p>In this paper, I give the first analysis of Quicksort with
median-of-$k$ pivot sampling on inputs with equal elements.
I presented this result at <a href="http://www.siam.org/meetings/analco18/">ANALCO 2018</a>;
the <a href="https://speakerdeck.com/sebawild/median-of-k-quicksort-is-optimal-for-many-equal-keys">slides</a> are available on speakerdeck.</p>

<p>I also presented the main result at the informal
<a href="http://aofa2017.cs.princeton.edu">AofA meeting</a> 2017.
<!-- , see [AofA slides](http://aofa2017.cs.princeton.edu/talks/contributed/aofa2017-talk-wild.pdf
). --></p>

<p>The result settles‚Äîunder some restrictions‚Äîa long-standing open problem,
the <em>Sedgewick-Bentley
conjecture</em>, posed in two talks by <a href="https://sedgewick.io/">Robert Sedgewick</a>:</p>

<blockquote>
  <p>Median-of-$k$ Quicksort with fat-pivot partitioning has asymptotically optimal
average behavior on any randomly ordered input up to a constant factor,
and that factor converges to 1 as $k\to\infty$.</p>
</blockquote>

<p><small>(<a href="https://sedgewick.io/wp-content/uploads/2022/03/1999-2001Sorting.pdf"><em>New research on the theory and practice of sorting</em></a> and
<a href="https://sedgewick.io/wp-content/uploads/2022/03/2002QuicksortIsOptimal.pdf"><em>Quicksort is Optimal</em></a>)</small></p>

<p><em>Fat-pivot</em> partitioning means that we split the input into three segments:
elements strictly smaller than the pivot, strictly larger than the pivot,
and equal to the pivot.
Hence all duplicates of the pivot are removed from recursive calls.</p>

<h2 id="input-model-many-duplicates">Input Model: Many Duplicates</h2>

<p>The input model are random permutations of fixed multisets,
i.e., there are $u$ different values occurring
exactly $x_1,\ldots,x_u$ times in the input.
For this general setting,
no progress has been made since
<a href="http://dx.doi.org/10.1137/0206018">Sedgewick‚Äôs seminal 1977 paper</a>.</p>

<p>I therefore restrict the inputs to allow only those
that have <em>‚Äúmany duplicates‚Äù</em>:
every of the $u$ distinct values appears $\Omega(n^\varepsilon)$ times in expectation for some constant $\varepsilon&gt;0$.</p>

<p>Having many duplicates is arguably the most relevant scenario
for studying how Quicksort performs:</p>

<ul>
  <li>This is the setting that differs most from the classic distinct-keys case.</li>
  <li>It is the setting that seems to suggest the use of tailor-based methods,
so that the result that the general-purpose Quicksort performs
just as good is most interesting.</li>
</ul>

<p>I have no reason to believe that the below result is not
true for the unrestricted case, but there are several
technical reasons why the restriction is hard to drop.</p>

<h2 id="the-result">The result</h2>

<p>In a nutshell, we find that
Quicksort needs asymptotically at most a factor $\alpha_k = \ln(2) / (H_{k+1} - H_{(k+1)/2})$
more comparisons than needed by <em>any</em> comparison-based method to
sort a random multiset permutation with many duplicates.</p>

<p>The key idea is to consider a related input model
where each value is drawn
i.i.d. (independent and identically distributed)
from a distribution with probability weights
$\mathbf q = (x_1/n,\ldots,x_u/n)$.</p>

<h2 id="step-1-separating-n-and-q">Step 1: Separating n and q</h2>

<p>The first ingredient for the analysis is a <em>separation theorem</em> that expresses
Quicksort‚Äôs cost as $a_{\mathbf q} n \pm O(n^{1-\varepsilon})$.</p>

<p>A form of this theorem is already given in my <a href="/publications/wild-2016">dissertation</a> (Theorem 8.16)
for the general case of $s$-way Quicksort with generic one-pass partitioning.
In my dissertation, I used a stronger many-duplicates assumption, but for this step it can be generalized.
The ANALCO paper gives the detailed proof
for median-of-$k$ Quicksort on $n$ elements drawn i.i.d. from
<em>any</em> discrete distribution $\mathbf q$.</p>

<h2 id="step-2-path-length-of-fringe-balanced-trees-with-duplicates">Step 2: Path Length of Fringe-Balanced Trees with duplicates</h2>

<p>The term $a_{\mathbf q}$ corresponds to the
average search costs in a <em>fringe-balanced search tree</em>
built from inserting $\mathbf q$ distributed values
until the tree contains all $u$ possible values.</p>

<p>Fringe-balanced trees are the search-tree equivalent of
median-of-$k$ Quicksort:
Leaves collect up to $k$ elements before a new internal
nodes is created, which then get the median of the $k$ collected
elements as label.
That way, the bottommost subtrees, i.e.,
those at the fringe of the tree,
have more balanced splits than in an ordinary search tree.</p>

<p>We can show that $a_{\mathbf q}$ is $\alpha_k$
times the <em>entropy</em> of $\mathbf q$ in an asymptotic sense
(unless the distribution becomes degenerate, i.e.,
the entropy is bounded by a constant).
That result might be of independent interest.</p>

<h2 id="step-3-translating-between-the-models">Step 3: Translating between the models</h2>
<p>These two steps together imply the main result
for i.i.d. inputs with many duplicates.
We can transfer them back to an upper bound for the multiset model.</p>

<h2 id="general-case-for-discrete-uniform-inputs">General Case for Discrete Uniform Inputs</h2>

<p>In the general setting for multiway Quicksort, an explicit expression for $a_{\mathbf q}$ is
still to be found, although it is naturally to conjecture
a similar entropy-bound as above.</p>

<p>For the special case of a <em>discrete uniform</em> distribution
in $ \lbrace 1,\ldots,u \rbrace $,
I found a general asymptotic solution in my <a href="/publications/wild-2016#equal-keys">dissertation</a> (Theorem 8.17)
that even applies to more cost measures than comparisons.
This case is particularly nice in
that‚Äîunder the many duplicates assumption‚Äîthe costs for Quicksort have the same form as for random permutations, only with $\ln(n)$
replaced by $\ln(u)$.</p>

<p>I presented this part of the analysis in
<a href="http://www.dagstuhl.de/en/program/calendar/semhp/?semnr=16101">Dagstuhl</a>,
see the <a href="https://speakerdeck.com/sebawild/quicksort-with-equal-keys">slides</a> on slideshare.</p>

	</div>
</article>

      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <h2 class="footer-heading">Sebastian Wild</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <p>Contact:</p>
        <ul class="social-media-list">
          <li><a href="mailto:%73%65%62%61%77%69%6C%64@%67%6D%61%69%6C.%63%6F%6D" title="Contact me">sebawild at gmail</a> ‚ãÖ
            <a href="http://pgp.mit.edu/pks/lookup?op=get&search=0x38600ABC14973198">PGP</a></li>
            <li><a href="mailto:%77%69%6C%64@%69%6E%66%6F%72%6D%61%74%69%6B.%75%6E%69-%6D%61%72%62%75%72%67.%64%65" title="Contact me">wild at informatik.uni-marburg.de</a>
              <!-- ‚ãÖ <a href="http://pgp.mit.edu/pks/lookup?op=get&search=0x34EE39A78B149255">PGP</a> --></li>
          <li><a href="mailto:%77%69%6C%64@%6C%69%76%65%72%70%6F%6F%6C.%61%63.%75%6B" title="Contact me">wild at liverpool.ac.uk</a> ‚ãÖ
            <a href="http://pgp.mit.edu/pks/lookup?op=get&search=0x34EE39A78B149255">PGP</a></li>

              <p>  </p>
          <li><del><a href="mailto:%77%69%6C%64@%75%77%61%74%65%72%6C%6F%6F.%63%61" title="Contact me">wild at uwaterloo.ca</a></del> ‚ãÖ
            <a href="http://pgp.mit.edu/pks/lookup?op=get&search=0x34EE39A78B149255">PGP</a></li>
          <li><del><a href="mailto:%77%69%6C%64@%63%73.%75%6E%69-%6B%6C.%64%65" title="Contact me">wild at cs.uni-kl.de</a></del></li>
          <p>  </p>
          <li><a href="https://www.uni-marburg.de/de/fb12/arbeitsgruppen/algorith/team/sebastian-wild">Website at UMR</a></li>
          <li><a href="https://www.liverpool.ac.uk/computer-science/staff/sebastian-wild">Website at UoL</a></li>
          <li><a href="https://www.csc.liv.ac.uk/~swild">intranet site at UoL</a></li>
          <li><a href="https://tcs.csc.liv.ac.uk">TCS @ Liverpool</a></li>
          <li><del><a href="http://wwwagak.cs.uni-kl.de/home/staff/sebastian-wild">(Old) website TU KL</a></del></li>

          

          
        </ul>
      </div>

      <div class="footer-col footer-col-2">
        <p>Elsewhere:</p>
        <ul class="contact-list">
          <li><a href="https://github.com/sebawild" title="GitHub sebawild"><i class="fab fa-github"></i> GitHub sebawild</a></li>
          <li><a href="https://www.linkedin.com/in/sebastian-wild-liverpool/"><i class="fab fa-linkedin"></i> LinkedIn profile</a></li>
          <li><a rel="me" href="https://mathstodon.xyz/@wild" title="Mastodon @wild@mathstodon.xyz" ><i class="fab fa-mastodon"></i> @wild@mathstodon.xyz</a></li>
          <li><del><a href="https://twitter.com/Sebastian_Wild_" title="Twitter @Sebastian_Wild_"><i class="fab fa-twitter"></i> @Sebastian_Wild_</a></del></li>
          <li><a href="https://bsky.app/profile/sebastianwild.bsky.social" title="Bluesky @sebastianwild.bsky.social">ü¶ã @sebastianwild</a></li>
          
          <p>  </p>
          <li><a href="http://orcid.org/0000-0002-6061-9177" title="ORCID: 0000-0002-6061-9177"><i class="ai ai-orcid"></i> 0000-0002-6061-9177</a></li>
          <li><a href="https://scholar.google.de/citations?user=aMyZiK0AAAAJ"><i class="ai ai-google-scholar"></i>
 Google Scholar profile</a></li>
          <li><a href="http://dblp.uni-trier.de/pers/hd/w/Wild:Sebastian"><i class="ai ai-dblp"></i> DBLP publication list</a></li>
          <li><a href="https://www.semanticscholar.org/author/3124206"><i class="ai ai-semantic-scholar"></i> Semantic Scholar Author Page</a></li>
          <li><a href="http://arxiv.org/a/wild_s_2"><i class="ai ai-arxiv"></i> arXiv Author ID</a></li>
        </ul>
      </div>

      <div class="footer-col footer-col-3">
        <p>Quick links:</p>
        <ul style="margin-top: -1.5ex;">
          <li><a href="/publications">my publications</a></li>
          <li><a href="https://disk.wild-inter.net:5001/sharing/QEnV8zAqs">my library</a></li>
        </ul>
      </div>
    </div>
  </div>
</footer>


  </body>

</html>
